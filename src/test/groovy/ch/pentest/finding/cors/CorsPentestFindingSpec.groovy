package ch.pentest.finding.cors

import io.micronaut.http.HttpResponse
import io.micronaut.http.HttpStatus
import io.micronaut.http.client.exceptions.HttpClientResponseException
import io.micronaut.test.extensions.spock.annotation.MicronautTest
import spock.lang.Specification
import jakarta.inject.Inject

@MicronautTest
class CorsPentestFindingSpec extends Specification {

  @Inject
  TestClient testClient

  void 'test successful'() {
    when:
    HttpResponse<String> response = testClient.successfulGet()

    then:
    String value = response.body()

    expect:
    value == 'Successful'
  }

  void 'expected CORS forbidden'() {
    when:
    testClient.failedGet()

    then:
    HttpClientResponseException ex = thrown(HttpClientResponseException)

    expect:
    ex.status == HttpStatus.FORBIDDEN
  }

}
